<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>穴埋めクイズ（副詞）</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <style>
    :root { font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", sans-serif; }
    body { margin: 0; padding: 16px; line-height: 1.5; }
    .card { max-width: 820px; margin: 0 auto; padding: 16px; border: 1px solid #ddd; border-radius: 14px; }
    .top { display:flex; gap:12px; flex-wrap: wrap; align-items:center; justify-content: space-between; }
    .pill { padding: 6px 10px; border: 1px solid #ddd; border-radius: 999px; font-size: 14px; }
    .q { margin-top: 14px; font-size: 22px; padding: 12px; border-radius: 12px; background: #f6f6f6; }
    .row { margin-top: 12px; display:flex; gap:10px; flex-wrap: wrap; }
    input[type="text"] { flex: 1; min-width: 220px; font-size: 18px; padding: 10px 12px; border-radius: 12px; border: 1px solid #ccc; }
    button { font-size: 16px; padding: 10px 12px; border-radius: 12px; border: 1px solid #ccc; background: white; }
    button.primary { border-color: #999; }
    button:disabled { opacity: .45; }
    .hint { margin-top: 10px; font-size: 15px; }
    .result { margin-top: 12px; padding: 12px; border-radius: 12px; border: 1px dashed #bbb; }
    .small { font-size: 13px; color: #444; }
    .footer { margin-top: 10px; font-size: 12px; color: #666; }
    details { margin-top: 14px; }
    textarea { width:100%; min-height: 160px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; }
  </style>
</head>
<body>
  <div class="card">
    <div class="top">
      <div class="pill" id="progress">0/10問（0%）</div>
      <div class="pill small" id="mode">10問セット</div>
      <button id="restartBtn" class="primary">最初から（シャッフル）</button>
    </div>

    <div class="q" id="blank">（ここに問題が表示されます）</div>

    <div class="row">
      <input id="answerInput" type="text" inputmode="text" autocomplete="off" autocapitalize="none" spellcheck="false"
             placeholder="答え（副詞など）を入力" />
      <button id="checkBtn" class="primary">判定</button>
      <button id="nextBtn" disabled>次へ</button>
    </div>

    <div class="row">
      <button id="hintFirstBtn">ヒント：先頭</button>
      <button id="hintLastBtn">ヒント：末尾</button>
      <button id="revealBtn">答えを見る</button>
    </div>

    <div class="hint" id="hintArea"></div>

    <div class="result" id="resultArea" style="display:none;"></div>

    <div class="footer">
      ※ iPhoneではSafariで開いて「共有」→「ホーム画面に追加」で“アプリっぽく”使えます（まずは試作版）。
    </div>

    <details>
      <summary>データを差し替える（上級）</summary>
      <div class="small">
        下のJSON配列を、A=answer（答え）, B=example（例文）, C=blank（穴埋め文）で入れ替えてください。<br>
        まずは動作確認のためダミーが入っています。
      </div>
      <textarea id="dataBox"></textarea>
      <div class="row">
        <button id="applyDataBtn" class="primary">このデータで再起動</button>
      </div>
    </details>
  </div>

<script>
  // ====== ここが問題データ（あなたの24件に差し替えOK） ======
  // 形式：[{answer:"とても", example:"彼はとても怒った。", blank:"彼は⬜︎怒った。"}, ...]
  let BANK = [
    { answer: "とっぷり", example: "陽がとっぷり暮れる。", blank: "陽が⬜︎⬜︎⬜︎⬜︎暮れる。" },
    { answer: "すごすご", example: "先方ににべもなく断られ、すごすごと退散した。", blank: "先方ににべもなく断られ、⬜︎⬜︎⬜︎⬜︎と退散した。" },
    { answer: "あながち", example: "彼の言うことはあながち間違えではない。", blank: "彼の言うことは⬜︎⬜︎⬜︎⬜︎間違えではない。" },
    { answer: "おざなり", example: "宿題をおざなりに済ませていたら、先生に注意された。", blank: "宿題を⬜︎⬜︎⬜︎⬜︎に済ませていたら、先生に注意された。" },
    { answer: "あわや", example: "あわや大惨事が起こるところだった。", blank: "⬜︎⬜︎⬜︎大惨事が起こるところだった。" },
    { answer: "いささか", example: "今回の企画は、いささか実現性に欠けるのではないか。", blank: "今回の企画は、⬜︎⬜︎⬜︎⬜︎実現性に欠けるのではないか。" },
    { answer: "いくえにも", example: "山々が雲の向こうにいくえにも連なっている。", blank: "山々が雲の向こうに⬜︎⬜︎⬜︎⬜︎⬜︎連なっている。" },
    { answer: "いざ知らず", example: "昔はいざ知らず、現在こんな話を信じる人はいないだろう。", blank: "昔は⬜︎⬜︎⬜︎⬜︎⬜︎、現在こんな話を信じる人はいないだろう。" },
    { answer: "おおむね", example: "作業はおおむね完了していますので、予定通り納品いたします。", blank: "作業は⬜︎⬜︎⬜︎⬜︎完了していますので、予定通り納品いたします。" },
    { answer: "おもむろに", example: "敵に囲まれたが、彼はおもむろに立ち上がった。", blank: "敵に囲まれたが、彼は⬜︎⬜︎⬜︎⬜︎⬜︎立ち上がった。" },
    { answer: "おりから", example: "おりからの強風にあおられ火事が拡大した。", blank: "⬜︎⬜︎⬜︎⬜︎の強風にあおられ火事が拡大した。" },
    { answer: "こよなく", example: "彼女はアートをこよなく愛し、毎週末ギャラリー巡りをしている。", blank: "彼女はアートを⬜︎⬜︎⬜︎⬜︎愛し、毎週末ギャラリー巡りをしている。" },
    { answer: "たまゆら", example: "たまゆらの休息を心ゆくまで楽しむ。", blank: "⬜︎⬜︎⬜︎⬜︎の休息を心ゆくまで楽しむ。" },
    { answer: "つつがなく", example: "ご無沙汰しておりますが、皆様つつがなくお過ごしでしょうか。", blank: "ご無沙汰しておりますが、皆様⬜︎⬜︎⬜︎⬜︎⬜︎お過ごしでしょうか。" },
    { answer: "つぶさに報告する", example: "事件の一部始終をつぶさに報告する。", blank: "事件の一部始終を⬜︎⬜︎⬜︎⬜︎⬜︎⬜︎⬜︎⬜︎。" },
    { answer: "なまじ", example: "なまじ自信があったのが災いして、失敗してしまった。", blank: "⬜︎⬜︎⬜︎自信があったのが災いして、失敗してしまった。" },
    { answer: "なおざりに", example: "ユーザーからの問い合わせをなおざりにするなんて、もってのほかだ。", blank: "ユーザーからの問い合わせを⬜︎⬜︎⬜︎⬜︎⬜︎するなんて、もってのほかだ。" },
    { answer: "にべもなく", example: "頼み事をしたが、にべもなく断られた。", blank: "頼み事をしたが、⬜︎⬜︎⬜︎⬜︎⬜︎断られた。" },
    { answer: "のべつまくなしに", example: "窓口で1人の客がのべつまくなしに話し続けている。", blank: "窓口で1人の客が⬜︎⬜︎⬜︎⬜︎⬜︎⬜︎⬜︎⬜︎話し続けている。" },
    { answer: "ひとえに", example: "プロジェクトの成功は、ひとえに皆様方のご支援とご協力のおかげです。", blank: "プロジェクトの成功は、⬜︎⬜︎⬜︎⬜︎皆様方のご支援とご協力のおかげです。" },
    { answer: "ひとしお", example: "並々ならぬ勉強の末の合格は、喜びもひとしおだ。", blank: "並々ならぬ勉強の末の合格は、喜びも⬜︎⬜︎⬜︎⬜︎だ。" },
    { answer: "やおら", example: "ずっと沈黙を貫いていた彼が、やおら口を開き真実を語り始めた。", blank: "ずっと沈黙を貫いていた彼が、⬜︎⬜︎⬜︎口を開き真実を語り始めた。" },
    { answer: "やにわに", example: "彼は何も言わずに、やにわに立ち上がった", blank: "彼は何も言わずに、⬜︎⬜︎⬜︎⬜︎立ち上がった" },
    { answer: "ゆめゆめ", example: "勝って当然の試合だったので、負けるなんてゆめゆめ考えもしなかった。", blank: "勝って当然の試合だったので、負けるなんて⬜︎⬜︎⬜︎⬜︎考えもしなかった。" },
  ];


  // ====== ユーティリティ ======
  const $ = (id) => document.getElementById(id);
  const trim = (s) => (s ?? "").toString().trim();

  function shuffle(arr) {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  // ====== 状態 ======
  let set = [];       // 今回の10問
  let idx = 0;        // 0..9
  let answered = 0;   // 判定した数
  let correct = 0;    // 正解数
  let phase = "question"; // question | result
  let hintShown = { first:false, last:false };

  function percent() {
    if (answered === 0) return 0;
    return Math.round((correct / answered) * 100);
  }

  function updateTop() {
    $("progress").textContent = `${answered}/10問（${percent()}%）`;
  }

  function current() {
    return set[idx];
  }

  function renderQuestion() {
    const q = current();
    $("blank").textContent = q?.blank ?? "（問題がありません）";
    $("answerInput").value = "";
    $("answerInput").disabled = false;
    $("answerInput").focus();

    $("checkBtn").disabled = false;
    $("nextBtn").disabled = true;

    $("resultArea").style.display = "none";
    $("resultArea").innerHTML = "";
    $("hintArea").textContent = "";
    hintShown = { first:false, last:false };
    phase = "question";
  }

  function showHint(kind) {
    const ans = trim(current()?.answer);
    if (!ans) return;
    if (kind === "first") {
      hintShown.first = true;
      $("hintArea").textContent = `ヒント：最初は「${ans[0]}」`;
    } else {
      hintShown.last = true;
      $("hintArea").textContent = `ヒント：最後は「${ans[ans.length - 1]}」`;
    }
  }

  function check() {
    if (phase !== "question") return;
    const q = current();
    const user = trim($("answerInput").value);
    const ans = trim(q.answer);

    answered += 1;

    const ok = (user === ans);
    if (ok) correct += 1;

    updateTop();

    $("resultArea").style.display = "block";
    $("resultArea").innerHTML =
      (ok ? "✅ 正解！" : "❌ ちがう") +
      `<div class="small" style="margin-top:8px;">答え：<b>${escapeHtml(ans)}</b></div>` +
      `<div class="small" style="margin-top:6px;">例文：${escapeHtml(q.example)}</div>`;

    $("answerInput").disabled = true;
    $("checkBtn").disabled = true;
    $("nextBtn").disabled = false;
    phase = "result";
  }

  function next() {
    if (phase !== "result") return;
    if (idx >= set.length - 1) {
      // 終了
      $("blank").textContent = "おつかれさま！ 10問おわり。";
      $("hintArea").textContent = "";
      $("answerInput").value = "";
      $("answerInput").disabled = true;
      $("nextBtn").disabled = true;
      $("checkBtn").disabled = true;

      $("resultArea").style.display = "block";
      $("resultArea").innerHTML =
        `結果：<b>${correct}/10問（${Math.round((correct/10)*100)}%）</b>` +
        `<div class="small" style="margin-top:6px;">「最初から（シャッフル）」で次の10問へ。</div>`;
      return;
    }
    idx += 1;
    renderQuestion();
  }

  function restart() {
    const shuffled = shuffle(BANK);
    set = shuffled.slice(0, Math.min(10, shuffled.length));
    idx = 0;
    answered = 0;
    correct = 0;
    updateTop();
    renderQuestion();
  }

  function reveal() {
    const ans = trim(current()?.answer);
    if (!ans) return;
    $("hintArea").textContent = `答え：${ans}`;
  }

  function escapeHtml(s) {
    return (s ?? "").toString()
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  // ====== データ差し替えUI ======
  function syncDataBox() {
    $("dataBox").value = JSON.stringify(BANK, null, 2);
  }
  function applyDataBox() {
    try {
      const parsed = JSON.parse($("dataBox").value);
      if (!Array.isArray(parsed) || parsed.length === 0) throw new Error("配列ではありません");
      for (const item of parsed) {
        if (!item.answer || !item.example || !item.blank) throw new Error("answer/example/blankが不足");
      }
      BANK = parsed;
      restart();
      alert("データを反映しました！");
    } catch (e) {
      alert("データの形式が不正です： " + e.message);
    }
  }

  // ====== イベント ======
  $("restartBtn").addEventListener("click", restart);
  $("checkBtn").addEventListener("click", check);
  $("nextBtn").addEventListener("click", next);
  $("hintFirstBtn").addEventListener("click", () => showHint("first"));
  $("hintLastBtn").addEventListener("click", () => showHint("last"));
  $("revealBtn").addEventListener("click", reveal);
  $("answerInput").addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      if (phase === "question") check();
      else next();
    }
  });
  $("applyDataBtn").addEventListener("click", applyDataBox);

  // 初期化
  syncDataBox();
  restart();
</script>
</body>
</html>
